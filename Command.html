async function getUpcoming(windowMin = 45) {
  const now    = Date.now();
  const cutoff = now + windowMin * 60_000;
  const events = await fetchJson('https://api.guildwars2.com/v2/events?ids=all');

  return events
    .filter(e => {
      // must have next_time and a valid location center array
      return e.next_time
          && e.location
          && Array.isArray(e.location.center)
          && e.location.center.length === 2;
    })
    .map(e => ({
      name:     e.name,
      map_id:   e.map_id,
      nextTime: new Date(e.next_time).getTime(),
      coord:    e.location.center
    }))
    .filter(e => e.nextTime > now && e.nextTime <= cutoff);
}
