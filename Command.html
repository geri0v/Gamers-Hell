<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8"/>
  <title>Test getUpcoming()</title>
</head>
<body>
  <h1>Check Console for Output</h1>
  <script>
    // 1) fetchJson helper
    async function fetchJson(url) {
      const res = await fetch(url);
      if (!res.ok) throw new Error(`HTTP ${res.status} â€“ ${res.statusText}`);
      return res.json();
    }

    // 2) Your getUpcoming function
    async function getUpcoming(windowMin = 45) {
      const now    = Date.now();
      const cutoff = now + windowMin * 60_000;

      const events = await fetchJson('https://api.guildwars2.com/v2/events?ids=all');
      console.log('raw events length:', events.length);

      return events
        .filter(e => 
          e.next_time &&
          e.location &&
          Array.isArray(e.location.center) &&
          e.location.center.length === 2
        )
        .map(e => ({
          name:     e.name,
          map_id:   e.map_id,
          nextTime: new Date(e.next_time).getTime(),
          coord:    e.location.center
        }))
        .filter(e => e.nextTime > now && e.nextTime <= cutoff);
    }

    // 3) Call it and log results
    (async () => {
      try {
        const upcoming = await getUpcoming(45);
        console.log('upcoming events in 45m:', upcoming);
      } catch (err) {
        console.error('getUpcoming error:', err);
      }
    })();
  </script>
</body>
</html>
