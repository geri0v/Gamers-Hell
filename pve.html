<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Gamers-Hell Command</title>
  <style>
    html, body { margin: 0; padding: 0; height: 100vh; }
    body {
      display: grid;
      grid-template-columns: 320px 1fr 0px;
      grid-template-areas: "navleft main navright";
      font-family: Arial, sans-serif;
      background: #3c6e8d65;
      min-height: 100vh;
      transition: grid-template-columns 0.3s;
    }
    body.sidebar-open {
      grid-template-columns: 320px 1fr 320px;
    }
    .sidenav  { grid-area: navleft; }
    .sidenav2 { grid-area: navright; background: #111; color: #818181; position: relative; transition: all 0.3s; }
    .main     { grid-area: main; overflow-y: auto; padding: 20px; box-sizing: border-box; transition: all 0.3s; }
    .sidenav, .sidenav2 {
      background: #111; color: #818181; overflow-y: auto; height: 100%;
    }
    .sidenav a, .sidenav2 a {
      display: block; padding: 8px 16px; font-size: 16px;
      text-decoration: none; color: inherit;
    }
    .sidenav a:hover, .sidenav2 a:hover { color: #f1f1f1; }
    .sidenav details { padding: 4px 16px; color: #818181; cursor: pointer; }
    .sidenav summary { list-style: none; font-size: 16px; user-select: none; }
    .sidenav summary::-webkit-details-marker { display: none; }
    .sidenav summary::before {
      content: "▸"; display: inline-block; width: 1em; transition: transform 0.2s;
    }
    .sidenav details[open] summary::before { content: "▾"; }
    .sidenav details a { padding-left: 32px; font-size: 15px; }
    .center { text-align: center; margin-bottom: 1em; }
    h1, h2 { margin: 0.5em 0; }
    h2 { border-bottom: 1px solid #ccc; padding-bottom: 0.2em; margin-top: 1.5em; }
    .cat-heading { font-size: 1.6em; margin: 1.5em 0 0.5em 0; color: #2b4765; }
    .textbox-container {
      display: flex; align-items: center; margin: 6px 0;
    }
    .textbox {
      flex: 1; padding: 6px; font-size: 14px;
      border: 1px solid #ccc; border-radius: 4px; background: #fff;
    }
    .copy-button {
      width: 24px; height: 24px; margin-left: 6px;
      border: none; cursor: pointer; border-radius: 4px;
      background: url('https://i.postimg.cc/Pf2Qp0Xq/World-Completion.png') no-repeat center/cover;
    }
    .copy-button:hover {
      background-image: url('https://i.postimg.cc/qMNzGyvH/pve-e6fdf7c3.png');
    }
    .drops-container {
      margin-left: 32px; margin-top: 8px;
    }
    .item-drop {
      display: flex; align-items: center; gap: 8px;
      margin: 4px 0; font-size: 14px;
    }
    .item-drop img { width: 24px; height: 24px; }
    .item-drop small { color: #555; margin-left: 4px; }
    details summary {
      cursor: pointer;
      font-weight: bold;
      background: #eee;
      padding: 4px 8px;
      border-radius: 4px;
      margin-bottom: 4px;
      user-select: none;
    }
    details { margin-bottom: 8px; }
    .boss-block { margin-bottom: 20px; background: #f8fcff; border-radius: 8px; box-shadow: 0 0 8px #d1e6f6; padding: 10px 0 10px 0; }
    .boss-block h3 { margin: 0 0 6px 0; }
    .drop-type-guaranteed { color: #007c1e; font-weight: bold; margin-left: 8px; }
    .drop-type-chance { color: #c00; font-weight: bold; margin-left: 8px; }
    .right-timer-toggle { margin: 1em 0 0.5em 0; text-align: center; }
    .right-timer-toggle button {
      background: #223; color: #fff; border: none; border-radius: 4px; padding: 8px 18px; font-size: 1em; cursor: pointer;
      transition: background 0.2s;
    }
    .right-timer-toggle button:hover { background: #2b4765; }
    .right-timer-content { text-align: center; }
    .sidepull-btn {
      position: fixed;
      right: 0;
      top: 40%;
      z-index: 1000;
      cursor: pointer;
      background: #223;
      color: #fff;
      padding: 16px 10px 16px 14px;
      border-radius: 8px 0 0 8px;
      font-size: 22px;
      box-shadow: 0 0 8px #223;
      display: none;
      transition: background 0.2s;
    }
    .sidepull-btn:hover { background: #2b4765; }
    @media (max-width: 1000px) {
      body { grid-template-columns: 0 1fr 0; }
      .sidenav, .sidenav2 { display: none; }
      .sidepull-btn { display: none !important; }
    }
    .iframe-container {
      width: 100%;
      height: 700px;
      overflow: hidden;
      border-radius: 8px;
      background: #222;
      margin-top: 10px;
    }
    .iframe-container iframe {
      width: 100%;
      height: 700px;
      border: none;
      background: #222;
    }
    .iframe-warning {
      color: #ffb300;
      font-size: 0.98em;
      background: #222;
      border-radius: 6px;
      padding: 10px;
      margin-top: 10px;
      margin-bottom: 0;
    }
  </style>
</head>
<body class="sidebar-open">
  <!-- Sidepull button for right sidebar -->
  <div class="sidepull-btn" id="sidepullBtn" title="Open Timetable">&#9776;</div>

  <!-- LEFT NAVIGATION MENU -->
  <nav class="sidenav" id="sideNav"></nav>

  <!-- MAIN CONTENT -->
  <div class="main">
    <section id="Welcome" class="center">
      <h1>Welcome Commander</h1>
      <script>
        (function(){
          const PASS = "PvE";
          if (prompt('Password?','') !== PASS) {
            location.href = 'https://sites.google.com/view/gamers-hell-community';
          } else alert('Welcome Commander');
        })();
      </script>
    </section>
    <div id="mainContent"></div>
    <section id="Credits" class="center">
      <h2>Credits</h2>
      <textarea rows="6" disabled>
Gamers-Hell Community
Players Vs Events:
  Blaz, Devilish Rain, Stormmyknight, Beina, Geri V

Websites:
  https://wiki.guildwars2.com/wiki
  https://gw2efficiency.com/
  http://gw2timer.com/
      </textarea>
    </section>
    <footer>&copy; 2025 Gamers-Hell Community</footer>
  </div>

  <!-- RIGHT SIDEBAR: GW2 Event Timer List via HTTPS iframe -->
  <nav class="sidenav2" id="rightSidebar">
    <div class="right-timer-toggle">
      <button id="toggleTimerBtn">Show Event Timer</button>
    </div>
    <div class="right-timer-content" id="timerContainer" style="display:none;">
      <h3 style="margin:0 0 12px 0;">Event Timetable (Live List)</h3>
      <div class="iframe-container" id="iframeContainer">
        <iframe id="gw2timerIframe"
          src="https://gw2timer.com/?page=Timetable&enu_Language=en&int_setClock=2&bol_use24Hour=true"
          allowtransparency="true"></iframe>
      </div>
      <div class="iframe-warning" id="iframeWarning" style="display:none;">
        <b>Note:</b> If the timer does not display, your browser may block HTTP iframes on HTTPS pages.<br>
        <a href="https://gw2timer.com/?page=Timetable&enu_Language=en&int_setClock=2&bol_use24Hour=true" target="_blank" style="color:#aaf;">Open GW2Timer in a new tab</a>
      </div>
    </div>
    <button id="closeSidebarBtn" style="position:absolute;top:8px;right:8px;font-size:22px;background:none;color:#fff;border:none;cursor:pointer;">×</button>
  </nav>

<script>
const data = {
  "Core Tyria": {
    "World Bosses": [
      {
        name: "Taidha Covington",
        code: "[&BKgBAAA=]",
        location: "Bloodtide Coast",
        drops: [
          { id: 46733, note: "Guaranteed" },
          { id: 19357, note: "Chance" },
          { id: 19361, note: "Chance" }
        ]
      },
      {
        name: "Karka Queen",
        code: "[&BNcGAAA=]",
        location: "Southsun Cove",
        drops: [
          { id: 37897, note: "Guaranteed" },
          { id: 37899, note: "Chance" },
          { id: 49509, note: "Chance" },
          { id: 45597, note: "Chance" },
          { id: 46713, note: "Chance" },
          { id: 46689, note: "Chance" }
        ]
      },
      {
        name: "Shadow Behemoth",
        code: "[&BPcAAAA=]",
        location: "Queensdale",
        drops: [
          { id: 46733, note: "Guaranteed"},
          { id: 8535, note: "Chance" },
          { id: 19360, note: "Chance" },
          { id: 31051, note: "Chance" }
        ]
      }
    ]
  }
};

function copyToClipboard(text) {
  navigator.clipboard.writeText(text).then(
    () => alert(`Copied:\n${text}`),
    () => alert('Copy failed!')
  );
}

function buildNav(parent, obj) {
  Object.entries(obj).forEach(([key,val]) => {
    if (Array.isArray(val)) {
      const a = document.createElement('a');
      a.href = `#${key.replace(/\s+/g,'')}`;
      a.textContent = key;
      parent.appendChild(a);
    } else {
      const details = document.createElement('details');
      const summary = document.createElement('summary');
      summary.textContent = key;
      details.appendChild(summary);
      buildNav(details,val);
      parent.appendChild(details);
    }
  });
}
function generateNav() {
  const nav = document.getElementById('sideNav');
  nav.innerHTML = '';
  nav.appendChild(Object.assign(document.createElement('a'), { href: '#Welcome', textContent: 'Welcome' }));
  buildNav(nav, data);
  nav.appendChild(Object.assign(document.createElement('a'), { href: '#Credits', textContent: 'Credits' }));
}

function formatCoin(value) {
  value = Number(value) || 0;
  const gold = Math.floor(value / 10000);
  const silver = Math.floor((value % 10000) / 100);
  const copper = value % 100;
  let str = '';
  if (gold) str += gold + 'g ';
  if (gold || silver) str += silver + 's ';
  str += copper + 'c';
  return str.trim();
}

async function fetchItemData(id) {
  try {
    const [item, price] = await Promise.all([
      fetch(`https://api.guildwars2.com/v2/items/${id}`).then(r=>r.json()),
      fetch(`https://api.guildwars2.com/v2/commerce/prices/${id}`).then(r=>r.json())
    ]);
    return {
      name: item.name,
      icon: item.icon,
      value: price?.sells?.unit_price || price.lowest_sell_unit_price || 0
    };
  } catch {
    return { name: `Item ${id}`, icon: '', value: 0 };
  }
}

async function buildContent(parent, obj) {
  for (const [cat, groups] of Object.entries(obj)) {
    const catDetails = document.createElement('details');
    catDetails.open = true;
    const catSummary = document.createElement('summary');
    catSummary.innerHTML = `<span class="cat-heading">${cat}</span>`;
    catDetails.appendChild(catSummary);

    for (const [group, bosses] of Object.entries(groups)) {
      const groupDetails = document.createElement('details');
      groupDetails.open = false;
      const groupSummary = document.createElement('summary');
      groupSummary.innerHTML = `<h2 style="display:inline">${group}</h2>`;
      groupDetails.appendChild(groupSummary);

      for (let boss of bosses) {
        const bossDiv = document.createElement('div');
        bossDiv.className = 'boss-block';
        bossDiv.innerHTML = `<h3>${boss.name} <small style="font-weight:normal;color:#888;">(${boss.location})</small></h3>`;
        const dropDataArr = [];
        for (const drop of boss.drops) {
          const itemData = await fetchItemData(drop.id);
          dropDataArr.push({ ...drop, ...itemData });
        }
        const guaranteedDrops = dropDataArr.filter(d => (d.note || '').toLowerCase() === 'guaranteed');
        const chanceDrops = dropDataArr.filter(d => (d.note || '').toLowerCase() === 'chance');
        let mostValuableChance = null;
        if (chanceDrops.length) {
          mostValuableChance = chanceDrops.reduce((max, d) => d.value > max.value ? d : max, chanceDrops[0]);
        }
        let parts = [];
        guaranteedDrops.forEach(d =>
          parts.push(`Guaranteed to drop ${d.name} (Value: ${formatCoin(d.value)})`)
        );
        if (mostValuableChance) {
          parts.push(`Chance to drop ${mostValuableChance.name} (Value: ${formatCoin(mostValuableChance.value)})`);
        }
        if (!guaranteedDrops.length && !chanceDrops.length) {
          dropDataArr.sort((a, b) => b.value - a.value);
          dropDataArr.forEach(d =>
            parts.push(`${d.name} (Value: ${formatCoin(d.value)})`)
          );
        }
        const copyText = `${boss.name} | ${boss.code} | ${boss.location} | ${parts.join(', ')}`;
        const wrap = document.createElement('div');
        wrap.className = 'textbox-container';
        const inp = document.createElement('input');
        inp.type = 'text';
        inp.className = 'textbox';
        inp.value = copyText;
        inp.readOnly = true;
        const btn = document.createElement('button');
        btn.className = 'copy-button';
        btn.title = `Copy ${boss.name}`;
        btn.onclick = ()=>copyToClipboard(copyText);
        wrap.appendChild(inp);
        wrap.appendChild(btn);
        bossDiv.appendChild(wrap);
        const dropsDetails = document.createElement('details');
        dropsDetails.open = false;
        const dropsSummary = document.createElement('summary');
        dropsSummary.textContent = 'Show/Hide Drops';
        dropsDetails.appendChild(dropsSummary);
        const dropsDiv = document.createElement('div');
        dropsDiv.className = 'drops-container';
        dropDataArr.forEach(d => {
          let dropType = '';
          if ((d.note || '').toLowerCase() === 'guaranteed') dropType = '<span class="drop-type-guaranteed">(Guaranteed)</span>';
          else if ((d.note || '').toLowerCase() === 'chance') dropType = '<span class="drop-type-chance">(Chance)</span>';
          const div = document.createElement('div');
          div.className = 'item-drop';
          div.innerHTML = `
            <img src="${d.icon||''}" alt="${d.name||''}">
            <span>${d.name}</span>
            ${dropType}
            <small>Value: ${formatCoin(d.value)}</small>
          `;
          dropsDiv.appendChild(div);
        });
        dropsDetails.appendChild(dropsDiv);
        bossDiv.appendChild(dropsDetails);

        groupDetails.appendChild(bossDiv);
      }
      catDetails.appendChild(groupDetails);
    }
    parent.appendChild(catDetails);
  }
}

document.addEventListener('DOMContentLoaded', async () => {
  generateNav();
  const main = document.getElementById('mainContent');
  main.innerHTML = '';
  await buildContent(main, data);

  // Timer sidebar logic
  const timerBtn = document.getElementById('toggleTimerBtn');
  const timerContainer = document.getElementById('timerContainer');
  const iframeContainer = document.getElementById('iframeContainer');
  const gw2timerIframe = document.getElementById('gw2timerIframe');
  const iframeWarning = document.getElementById('iframeWarning');
  let timerVisible = false;
  timerBtn.onclick = function() {
    timerVisible = !timerVisible;
    timerContainer.style.display = timerVisible ? "" : "none";
    timerBtn.textContent = timerVisible ? "Hide Event Timer" : "Show Event Timer";
    if (timerVisible) {
      // Try to detect if iframe is blocked (may not work in all browsers)
      setTimeout(() => {
        try {
          // Try to access the iframe contentDocument (will throw if blocked)
          let doc = gw2timerIframe.contentDocument || gw2timerIframe.contentWindow.document;
          if (!doc || !doc.body || doc.body.innerHTML.length < 100) {
            iframeWarning.style.display = '';
          } else {
            iframeWarning.style.display = 'none';
          }
        } catch (e) {
          iframeWarning.style.display = '';
        }
      }, 2000);
    }
  };

  // Sidebar hide/show logic
  const sidebar = document.getElementById('rightSidebar');
  const sidepull = document.getElementById('sidepullBtn');
  const closeBtn = document.getElementById('closeSidebarBtn');
  function hideSidebar() {
    sidebar.style.display = 'none';
    sidepull.style.display = '';
    document.body.classList.remove('sidebar-open');
  }
  function showSidebar() {
    sidebar.style.display = '';
    sidepull.style.display = 'none';
    document.body.classList.add('sidebar-open');
  }
  closeBtn.onclick = hideSidebar;
  sidepull.onclick = showSidebar;
  sidepull.style.display = 'none';

  // Show sidepull if sidebar is hidden on load (for mobile)
  if (sidebar.style.display === 'none') sidepull.style.display = '';
});
</script>
</body>
</html>
