<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Gamers-Hell Command</title>
  <style>
    /* ====== GRID LAYOUT ====== */
    html, body { margin: 0; padding: 0; height: 100vh; }
    body {
      display: grid;
      grid-template-columns: 360px 1fr 360px;
      grid-template-areas: "navleft main navright";
      font-family: Arial, sans-serif;
      background: #3c6e8d65;
    }
    .sidenav  { grid-area: navleft; }
    .sidenav2 { grid-area: navright; }
    .main     { grid-area: main; overflow-y: auto; padding: 20px; box-sizing: border-box; }

    /* ====== SIDEBARS ====== */
    .sidenav, .sidenav2 {
      background: #111; color: #818181; overflow-y: auto; height: 100%;
    }
    .sidenav a, .sidenav2 a {
      display: block; padding: 8px 16px; font-size: 16px;
      text-decoration: none; color: inherit;
    }
    .sidenav a:hover, .sidenav2 a:hover { color: #f1f1f1; }

    /* ====== COLLAPSIBLE NAV ====== */
    .sidenav details { padding: 4px 16px; color: #818181; cursor: pointer; }
    .sidenav summary { list-style: none; font-size: 16px; user-select: none; }
    .sidenav summary::-webkit-details-marker { display: none; }
    .sidenav summary::before {
      content: "▸"; display: inline-block; width: 1em; transition: transform 0.2s;
    }
    .sidenav details[open] summary::before { content: "▾"; }
    .sidenav details a { padding-left: 32px; font-size: 15px; }

    /* ====== MAIN CONTENT ====== */
    .center { text-align: center; margin-bottom: 1em; }
    h1, h2 { margin: 0.5em 0; }
    h2 {
      border-bottom: 1px solid #ccc; padding-bottom: 0.2em;
      margin-top: 1.5em;
    }

    /* ====== TELEPORTER ROWS ====== */
    .textbox-container {
      display: flex; align-items: center; margin: 6px 0;
    }
    .textbox {
      flex: 1; padding: 6px; font-size: 14px;
      border: 1px solid #ccc; border-radius: 4px; background: #fff;
    }
    .copy-button {
      width: 24px; height: 24px; margin-left: 6px;
      border: none; cursor: pointer; border-radius: 4px;
      background: url('https://i.postimg.cc/Pf2Qp0Xq/World-Completion.png')
                  no-repeat center/cover;
    }
    .copy-button:hover {
      background-image: url('https://i.postimg.cc/qMNzGyvH/pve-e6fdf7c3.png');
    }

    /* ====== DROPS LIST ====== */
    .drops-container {
      margin-left: 32px; margin-top: 8px;
    }
    .item-drop {
      display: flex; align-items: center; gap: 8px;
      margin: 4px 0; font-size: 14px;
    }
    .item-drop img {
      width: 24px; height: 24px;
    }
    .item-drop small {
      color: #555; margin-left: 4px;
    }

    footer {
      text-align: center; padding: 1em 0; background: #ececec;
      margin-top: 2em; font-size: 0.9em;
    }
    textarea { width: 100%; max-width: 600px; }
  </style>
</head>
<body>
  <!-- LEFT NAV -->
  <nav class="sidenav" id="sideNav"></nav>

  <!-- MAIN CONTENT -->
  <div class="main">

    <!-- Welcome & Password Prompt -->
    <section id="Welcome" class="center">
      <h1>Welcome Commander</h1>
      <script>
        (function(){
          const PASS = "PvE";
          if (prompt('Password?','') !== PASS) {
            location.href = 'https://sites.google.com/view/gamers-hell-community';
          } else alert('Welcome Commander');
        })();
      </script>
    </section>

    <!-- Dynamic Boss Content Goes Here -->
    <div id="mainContent"></div>

    <!-- Credits -->
    <section id="Credits" class="center">
      <h2>Credits</h2>
      <textarea rows="6" disabled>
Gamers-Hell Community
Players Vs Events:
  Blaz, Devilish Rain, Stormmyknight, Beina, Geri V

Websites:
  https://wiki.guildwars2.com/wiki
  https://gw2efficiency.com/
  http://gw2timer.com/
      </textarea>
    </section>

    <footer>&copy; 2025 Gamers-Hell Community</footer>
  </div>

  <!-- RIGHT TIMER -->
  <nav class="sidenav2">
    <iframe
      src="http://gw2timer.com/?page=Timetable&enu_Language=en&int_setClock=2&bol_use24Hour=true"
      width="100%" height="100%" frameborder="0"
      style="box-shadow:0 0 12px #223;">
    </iframe>
  </nav>
<script>
  // 1) Boss Data + Drops (add real item IDs under drops[])
  const data = {
    "Core Tyria": {
      "World Bosses": [
        {
          name: "Taidha Covington",
          code: "[&BKgBAAA=]",
          drops: [24305, 24567]
        },
        {
          name: "Karka Queen",
          code: "[&BNcGAAA=]",
          drops: [30698, 43141]
        },
        {
          name: "Jungle Wurm",
          code: "[&BEEFAAA=]",
          drops: [19639, 19716]
        }
      ],
      "Ley-Line Anomaly": [
        { name: "Legendary Anomaly A", code: "[&BEwCAAA=]", drops: [65537] },
        { name: "Legendary Anomaly B", code: "[&BOcBAAA=]", drops: [65538] }
      ]
    },
    // … repeat for other categories …
  };

  // 2) Copy-to-clipboard helper
  function copyToClipboard(id) {
    const tb = document.getElementById(id);
    tb.disabled = false;
    tb.select();
    document.execCommand('copy');
    tb.disabled = true;
    alert(`Copied: ${tb.value}`);
  }

  // 3) Sidebar generation
  function buildNav(parent, obj) {
    Object.entries(obj).forEach(([key,val]) => {
      if (Array.isArray(val)) {
        const a = document.createElement('a');
        a.href = `#${key.replace(/\s+/g,'')}`;
        a.textContent = key;
        parent.appendChild(a);
      } else {
        const details = document.createElement('details');
        const summary = document.createElement('summary');
        summary.textContent = key;
        details.appendChild(summary);
        buildNav(details,val);
        parent.appendChild(details);
      }
    });
  }

  function generateNav() {
    const nav = document.getElementById('sideNav');
    nav.innerHTML = '';
    // static
    const w = document.createElement('a');
    w.href = '#Welcome'; w.textContent = 'Welcome';
    nav.appendChild(w);
    // dynamic
    buildNav(nav, data);
    // credits
    const c = document.createElement('a');
    c.href = '#Credits'; c.textContent = 'Credits';
    nav.appendChild(c);
  }

  // 4) Fetch item data & TP prices in batches
  async function fetchAllDropData(ids) {
    const chunk = (arr, size) =>
      arr.reduce((r,v,i) => {
        if (i % size === 0) r.push([]);
        r[r.length-1].push(v);
        return r;
      }, []);
    const batches = chunk(ids,100);
    const map = {};

    await Promise.all(batches.map(async batch => {
      const [items, prices] = await Promise.all([
        fetch(`https://api.guildwars2.com/v2/items?ids=${batch.join(',')}`)
          .then(r=>r.json()),
        fetch(`https://api.guildwars2.com/v2/commerce/prices?ids=${batch.join(',')}`)
          .then(r=>r.json())
      ]);
      items.forEach(item => {
        const p = prices.find(x=>x.id===item.id) || {};
        map[item.id] = {
          name: item.name,
          icon: item.icon,
          bound: item.binding === 'Account',
          buy: p.highest_buy_unit_price || 0,
          sell: p.lowest_sell_unit_price || 0
        };
      });
    }));

    return map;
  }

  // 5) Recursive content builder
  function buildContent(parent, obj, info) {
    Object.entries(obj).forEach(([key,val]) => {
      if (Array.isArray(val)) {
        const section = document.createElement('section');
        section.id = key.replace(/\s+/g,'');
        section.innerHTML = `<h2>${key}</h2>`;

        val.forEach((boss,i) => {
          // teleport row
          const wrap = document.createElement('div');
          wrap.className = 'textbox-container';

          const inp = document.createElement('input');
          inp.type = 'text';
          inp.className = 'textbox';
          inp.value = `${boss.name}: ${boss.code}`;
          inp.id = `tb_${section.id}_${i}`;
          inp.disabled = true;

          const btn = document.createElement('button');
          btn.className = 'copy-button';
          btn.title = `Copy ${boss.name}`;
          btn.onclick = ()=>copyToClipboard(inp.id);

          wrap.appendChild(inp);
          wrap.appendChild(btn);
          section.appendChild(wrap);

          // drops
          if (Array.isArray(boss.drops)) {
            const dropsDiv = document.createElement('div');
            dropsDiv.className = 'drops-container';

            boss.drops.forEach(id => {
              const d = document.createElement('div');
              d.className = 'item-drop';
              const x = info[id] || {};
              d.innerHTML = `
                <img src="${x.icon||''}" alt="${x.name||id}">
                <span>${x.name||'Unknown Item'}</span>
                <small>Buy: ${x.buy} ⛃ | Sell: ${x.sell} ⛃</small>
                <small>Account Bound: ${x.bound? 'Yes':'No'}</small>
              `;
              dropsDiv.appendChild(d);
            });
            section.appendChild(dropsDiv);
          }
        });

        parent.appendChild(section);
      }
      else {
        buildContent(parent,val,info);
      }
    });
  }

  // 6) Initialize on DOM ready
  document.addEventListener('DOMContentLoaded', async () => {
    generateNav();

    // collect unique drop IDs
    const allIds = [];
    (function collect(o){
      Object.values(o).forEach(v => {
        if (Array.isArray(v))
          v.forEach(b=> b.drops?.forEach(id=> allIds.push(id)));
        else collect(v);
      });
    })(data);

    const info = await fetchAllDropData([...new Set(allIds)]);
    const main = document.getElementById('mainContent');
    main.innerHTML = '';
    buildContent(main, data, info);
  });
</script>
</body>
</html>
