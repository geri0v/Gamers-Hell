<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Gamers-Hell Command</title>
  <style>
    html, body { margin: 0; padding: 0; height: 100vh; }
    body {
      display: grid;
      grid-template-columns: 360px 1fr 360px;
      grid-template-areas: "navleft main navright";
      font-family: Arial, sans-serif;
      background: #3c6e8d65;
    }
    .sidenav  { grid-area: navleft; }
    .sidenav2 { grid-area: navright; }
    .main     { grid-area: main; overflow-y: auto; padding: 20px; box-sizing: border-box; }
    .sidenav, .sidenav2 {
      background: #111; color: #818181; overflow-y: auto; height: 100%;
    }
    .sidenav a, .sidenav2 a {
      display: block; padding: 8px 16px; font-size: 16px;
      text-decoration: none; color: inherit;
    }
    .sidenav a:hover, .sidenav2 a:hover { color: #f1f1f1; }
    .sidenav details { padding: 4px 16px; color: #818181; cursor: pointer; }
    .sidenav summary { list-style: none; font-size: 16px; user-select: none; }
    .sidenav summary::-webkit-details-marker { display: none; }
    .sidenav summary::before {
      content: "▸"; display: inline-block; width: 1em; transition: transform 0.2s;
    }
    .sidenav details[open] summary::before { content: "▾"; }
    .sidenav details a { padding-left: 32px; font-size: 15px; }
    .center { text-align: center; margin-bottom: 1em; }
    h1, h2 { margin: 0.5em 0; }
    h2 { border-bottom: 1px solid #ccc; padding-bottom: 0.2em; margin-top: 1.5em; }
    .textbox-container {
      display: flex; align-items: center; margin: 6px 0;
    }
    .textbox {
      flex: 1; padding: 6px; font-size: 14px;
      border: 1px solid #ccc; border-radius: 4px; background: #fff;
    }
    .copy-button {
      width: 24px; height: 24px; margin-left: 6px;
      border: none; cursor: pointer; border-radius: 4px;
      background: url('https://i.postimg.cc/Pf2Qp0Xq/World-Completion.png') no-repeat center/cover;
    }
    .copy-button:hover {
      background-image: url('https://i.postimg.cc/qMNzGyvH/pve-e6fdf7c3.png');
    }
    .drops-container {
      margin-left: 32px; margin-top: 8px;
    }
    .item-drop {
      display: flex; align-items: center; gap: 8px;
      margin: 4px 0; font-size: 14px;
    }
    .item-drop img { width: 24px; height: 24px; }
    .item-drop small { color: #555; margin-left: 4px; }
    footer {
      text-align: center; padding: 1em 0; background: #ececec;
      margin-top: 2em; font-size: 0.9em;
    }
    textarea { width: 100%; max-width: 600px; }
  </style>
</head>
<body>
  <!-- LEFT NAV -->
  <nav class="sidenav" id="sideNav"></nav>
  <!-- MAIN CONTENT -->
  <div class="main">
    <section id="Welcome" class="center">
      <h1>Welcome Commander</h1>
      <script>
        (function(){
          const PASS = "PvE";
          if (prompt('Password?','') !== PASS) {
            location.href = 'https://sites.google.com/view/gamers-hell-community';
          } else alert('Welcome Commander');
        })();
      </script>
    </section>
    <div id="mainContent"></div>
    <section id="Credits" class="center">
      <h2>Credits</h2>
      <textarea rows="6" disabled>
Gamers-Hell Community
Players Vs Events:
  Blaz, Devilish Rain, Stormmyknight, Beina, Geri V

Websites:
  https://wiki.guildwars2.com/wiki
  https://gw2efficiency.com/
  http://gw2timer.com/
      </textarea>
    </section>
    <footer>&copy; 2025 Gamers-Hell Community</footer>
  </div>
  <!-- RIGHT TIMER -->
  <nav class="sidenav2">
    <iframe
      src="http://gw2timer.com/?page=Timetable&enu_Language=en&int_setClock=2&bol_use24Hour=true"
      width="100%" height="100%" frameborder="0"
      style="box-shadow:0 0 12px #223;">
    </iframe>
  </nav>
<script>
// ========== DATA ==========
const data = {
  "Core Tyria": {
    "World Bosses": [
      {
        name: "Taidha Covington",
        code: "[&BKgBAAA=]",
        location: "Bloodtide Coast",
        drops: [
          { id: 24305, note: "Bloodstone Chest" },
          { id: 24567, note: "Mystic Coin" }
        ]
      },
      {
        name: "Karka Queen",
        code: "[&BNcGAAA=]",
        location: "Southsun Cove",
        drops: [
          { id: 30698, note: "Karka Shell" },
          { id: 43141, note: "Queen's Gauntlet Ticket" }
        ]
      }
    ]
  }
};

// ========== COPY TO CLIPBOARD ==========
function copyToClipboard(text) {
  navigator.clipboard.writeText(text).then(
    () => alert(`Copied:\n${text}`),
    () => alert('Copy failed!')
  );
}

// ========== SIDEBAR ==========
function buildNav(parent, obj) {
  Object.entries(obj).forEach(([key,val]) => {
    if (Array.isArray(val)) {
      const a = document.createElement('a');
      a.href = `#${key.replace(/\s+/g,'')}`;
      a.textContent = key;
      parent.appendChild(a);
    } else {
      const details = document.createElement('details');
      const summary = document.createElement('summary');
      summary.textContent = key;
      details.appendChild(summary);
      buildNav(details,val);
      parent.appendChild(details);
    }
  });
}
function generateNav() {
  const nav = document.getElementById('sideNav');
  nav.innerHTML = '';
  const w = document.createElement('a');
  w.href = '#Welcome'; w.textContent = 'Welcome';
  nav.appendChild(w);
  buildNav(nav, data);
  const c = document.createElement('a');
  c.href = '#Credits'; c.textContent = 'Credits';
  nav.appendChild(c);
}

// ========== ITEM DATA FETCHING ==========
async function fetchItemData(ids) {
  // Try GW2 API first
  try {
    const items = await fetch(`https://api.guildwars2.com/v2/items?ids=${ids.join(',')}`).then(r=>r.json());
    const prices = await fetch(`https://api.guildwars2.com/v2/commerce/prices?ids=${ids.join(',')}`).then(r=>r.json());
    const priceMap = {};
    prices.forEach(p => priceMap[p.id] = p);
    const result = {};
    items.forEach(item => {
      const p = priceMap[item.id] || {};
      result[item.id] = {
        name: item.name,
        icon: item.icon,
        bound: item.flags && item.flags.includes('AccountBound'),
        buy: p?.buys?.unit_price || p.highest_buy_unit_price || 0,
        sell: p?.sells?.unit_price || p.lowest_sell_unit_price || 0
      };
    });
    return result;
  } catch(e) {
    // Fallback: Try GW2 Wiki for names/icons (no prices)
    const result = {};
    await Promise.all(ids.map(async id => {
      try {
        const url = `https://wiki.guildwars2.com/api.php?action=askargs&format=json&parameters=[[Has game id::${id}]]|?Has_icon|?Has_name`;
        const data = await fetch(url, {mode:'cors'}).then(r=>r.json());
        const pages = data.query.results;
        const page = Object.values(pages)[0] || {};
        result[id] = {
          name: page.printouts?.Has_name?.[0] || `Item ${id}`,
          icon: page.printouts?.Has_icon?.[0] || '',
          bound: false,
          buy: 0,
          sell: 0
        };
      } catch(e2) {
        result[id] = { name: `Item ${id}`, icon: '', bound: false, buy: 0, sell: 0 };
      }
    }));
    return result;
  }
}

// ========== MAIN CONTENT ==========
function buildContent(parent, obj, info) {
  Object.entries(obj).forEach(([key,val]) => {
    if (Array.isArray(val)) {
      const section = document.createElement('section');
      section.id = key.replace(/\s+/g,'');
      section.innerHTML = `<h2>${key}</h2>`;
      val.forEach((boss,i) => {
        // Compose copy string
        const dropStrings = boss.drops.map(drop => {
          const d = info[drop.id] || {};
          return `${drop.note || d.name || 'Unknown'} (Buy: ${d.buy} ⛃, Sell: ${d.sell} ⛃)`;
        }).join(' | ');
        const copyText = `${boss.name} | ${boss.code} | ${boss.location} | ${dropStrings}`;
        // Teleport row
        const wrap = document.createElement('div');
        wrap.className = 'textbox-container';
        const inp = document.createElement('input');
        inp.type = 'text';
        inp.className = 'textbox';
        inp.value = copyText;
        inp.readOnly = true;
        const btn = document.createElement('button');
        btn.className = 'copy-button';
        btn.title = `Copy ${boss.name}`;
        btn.onclick = ()=>copyToClipboard(copyText);
        wrap.appendChild(inp);
        wrap.appendChild(btn);
        section.appendChild(wrap);
        // Drops
        const dropsDiv = document.createElement('div');
        dropsDiv.className = 'drops-container';
        boss.drops.forEach(drop => {
          const d = info[drop.id] || {};
          const div = document.createElement('div');
          div.className = 'item-drop';
          div.innerHTML = `
            <img src="${d.icon||''}" alt="${d.name||drop.id}">
            <span>${drop.note || d.name || 'Unknown Item'}</span>
            <small>Buy: ${d.buy} ⛃ | Sell: ${d.sell} ⛃</small>
            <small>Account Bound: ${d.bound? 'Yes':'No'}</small>
          `;
          dropsDiv.appendChild(div);
        });
        section.appendChild(dropsDiv);
      });
      parent.appendChild(section);
    } else {
      buildContent(parent,val,info);
    }
  });
}

// ========== INIT ==========
document.addEventListener('DOMContentLoaded', async () => {
  generateNav();
  // Collect unique drop IDs
  const allIds = [];
  (function collect(o){
    Object.values(o).forEach(v => {
      if (Array.isArray(v))
        v.forEach(b=> b.drops?.forEach(drop=> allIds.push(drop.id)));
      else collect(v);
    });
  })(data);
  const info = await fetchItemData([...new Set(allIds)]);
  const main = document.getElementById('mainContent');
  main.innerHTML = '';
  buildContent(main, data, info);
});
</script>
</body>
</html>
