<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Gamers-Hell Teleporters</title>
  <style>
    html, body {margin:0; padding:0; height:100vh;}
    body {
      display:grid;
      grid-template-columns:360px 1fr 360px;
      grid-template-areas:"navleft main navright";
      font-family:Arial,sans-serif;
      background:#3c6e8d65; color:#333;
    }
    .sidenav  {grid-area:navleft; background:#111; color:#818181; overflow-y:auto;}
    .sidenav2 {grid-area:navright;background:#111; color:#818181; overflow-y:auto;}
    .main     {grid-area:main; overflow-y:auto; padding:20px;}

    /* Links */
    .sidenav a, .sidenav2 a {
      display:block; padding:8px 16px; font-size:16px;
      text-decoration:none; color:inherit;
    }
    .sidenav a:hover, .sidenav2 a:hover {color:#f1f1f1;}

    /* Collapsible menu arrows */
    .sidenav details {padding:4px 16px; cursor:pointer;}
    .sidenav summary {
      list-style:none; font-size:16px; user-select:none;
    }
    .sidenav summary::before {
      content:"▸"; display:inline-block; width:1em;
      transition:transform .2s;
    }
    .sidenav details[open] summary::before {content:"▾";}
    .sidenav details a {padding-left:32px; font-size:15px;}

    /* Typography */
    h1,h2 {margin:.5em 0;}
    h2 {
      margin-top:1.5em; border-bottom:1px solid #ccc;
      padding-bottom:.2em;
    }
    .center {text-align:center; margin-bottom:1em;}

    /* Teleporter rows */
    .textbox-container {
      display:flex; align-items:center; margin:6px 0;
    }
    .textbox {
      flex:1; padding:6px; font-size:14px;
      border:1px solid #ccc; border-radius:4px;
      background:#fff;
    }
    .copy-button {
      width:24px; height:24px; margin-left:6px;
      border:none; cursor:pointer; border-radius:4px;
      background:url('https://i.postimg.cc/Pf2Qp0Xq/World-Completion.png')
                 center/cover no-repeat;
    }
    .copy-button:hover {
      background-image:url('https://i.postimg.cc/qMNzGyvH/pve-e6fdf7c3.png');
    }

    textarea {width:100%; max-width:600px;}
    footer {
      text-align:center; padding:1em 0; background:#ececec;
      margin-top:2em; font-size:.9em;
    }
  </style>
</head>
<body>

  <!-- LEFT NAV -->
  <nav class="sidenav" id="sideNav"></nav>

  <!-- MAIN CONTENT -->
  <div class="main">
    <section id="Welcome" class="center">
      <h1>Welcome Commander</h1>
      <script>
        (function(){
          const PASS = "PvE";
          if (prompt("Password?") !== PASS) {
            location.href = "https://sites.google.com/view/gamers-hell-community";
          } else alert("Welcome Commander");
        })();
      </script>
    </section>

    <div id="mainContent"></div>

    <section id="Credits" class="center">
      <h2>Credits</h2>
      <textarea rows="6" disabled>
Gamers-Hell Community
Players Vs Events: 
  Blaz, Devilish Rain, Stormmyknight, Beina, Geri V

Websites:
  https://wiki.guildwars2.com/wiki
  https://gw2efficiency.com/
  http://gw2timer.com/
      </textarea>
    </section>

    <footer>&copy; 2025 Gamers-Hell Community</footer>
  </div>

  <!-- RIGHT TIMER IFRAME -->
  <nav class="sidenav2">
    <iframe
      src="https://gw2timer.com/?page=Timetable&enu_Language=en&int_setClock=2&bol_use24Hour=true"
      width="100%" height="100%" frameborder="0"
      style="box-shadow:0 0 12px #223;">
    </iframe>
  </nav>

  <!-- SCRIPT: fetch & render from Google Sheets -->
  <script>
    const SHEET_ID   = "1drEpltlQrycYXTHHG8K1xiQNvHZgQk0z2JOPgK0E0yA";
    const SHEET_GIDS = [
      "159648992",  // Core Tyria tab
      "1712489673", // Living World S1
      "1641486649"  // Living World S2
      // …add more GIDs here
    ];

    // Fetch a single tab via GViz JSON
    async function fetchSheet(id, gid) {
      const url = `https://docs.google.com/spreadsheets/d/${id}/gviz/tq?gid=${gid}&tqx=out:json`;
      const res = await fetch(url);
      if (!res.ok) throw new Error(`HTTP ${res.status}`);
      const txt  = await res.text();
      const json = JSON.parse(txt.slice(txt.indexOf("{"), txt.lastIndexOf("}")+1));
      return json.table.rows.map(r => (r.c||[]).map(c => c?.v || ""));
    }

    // Fetch all tabs, merge rows—skip header after first
    async function fetchAll(id, gids) {
      let all = [];
      for (let i=0; i<gids.length; i++) {
        const rows = await fetchSheet(id, gids[i]);
        all = i===0 ? rows : all.concat(rows.slice(1));
      }
      return all;
    }

    // Convert rows to nested data
    function rowsToData(rows) {
      const data = {};
      if (!rows.length) return data;
      const header = rows[0].map(h => (""+h).toLowerCase());
      const body   = rows.slice(1);

      // Decide columns: 3-col or 4-col
      const hasSub = header.length >= 4 && header[1].includes("sub");

      body.forEach(r => {
        if (!r) return;
        // normalize cell values
        const cells = r.map(x => (x||"").toString().trim());
        let cat, sub, name, code;
        if (hasSub) {
          [cat, sub, name, code] = cells;
        } else {
          [cat, name, code] = cells;
          sub = "General";
        }
        if (!name && !code) return;
        const C = cat || "Other";
        const S = sub || "General";
        if (!data[C]) data[C] = {};
        if (!data[C][S]) data[C][S] = [];
        data[C][S].push({ name, code });
      });
      return data;
    }

    // Copy-to-clipboard
    function copyToClipboard(id) {
      const tb = document.getElementById(id);
      tb.disabled = false;
      tb.select();
      document.execCommand("copy");
      tb.disabled = true;
      alert(`Copied: ${tb.value}`);
    }

    // Build sidebar nav, flatten if only “General”
    function generateNav(data) {
      const nav = document.getElementById("sideNav");
      nav.innerHTML = "";
      // static Welcome
      let a = document.createElement("a");
      a.href = "#Welcome"; a.textContent = "Welcome";
      nav.appendChild(a);

      Object.entries(data).forEach(([cat, subs]) => {
        const keys = Object.keys(subs);
        if (keys.length===1 && keys[0]==="General") {
          // no real sub-menu
          const link = document.createElement("a");
          link.href = `#${cat.replace(/\s+/g,"")}`;
          link.textContent = cat;
          nav.appendChild(link);
        } else {
          // expandable
          const d = document.createElement("details");
          const s = document.createElement("summary");
          s.textContent = cat;
          d.appendChild(s);
          keys.forEach(sub => {
            const link = document.createElement("a");
            link.href = `#${cat.replace(/\s+/g,"")}_${sub.replace(/\s+/g,"")}`;
            link.textContent = sub;
            d.appendChild(link);
          });
          nav.appendChild(d);
        }
      });

      // static Credits
      a = document.createElement("a");
      a.href = "#Credits"; a.textContent = "Credits";
      nav.appendChild(a);
    }

    // Build main content, matching nav logic
    function buildContent(data) {
      const container = document.getElementById("mainContent");
      container.innerHTML = "";
      Object.entries(data).forEach(([cat, subs]) => {
        const keys = Object.keys(subs);
        if (keys.length===1 && keys[0]==="General") {
          // single section
          const sec = document.createElement("section");
          sec.id = cat.replace(/\s+/g,"");
          const h2 = document.createElement("h2");
          h2.textContent = cat;
          sec.appendChild(h2);
          subs.General.forEach((item,i) => {
            const wrap = document.createElement("div");
            wrap.className = "textbox-container";
            const inp = document.createElement("input");
            inp.type = "text"; inp.className = "textbox";
            inp.value = `${item.name}: ${item.code}`;
            inp.id = `tb_${sec.id}_${i}`;
            inp.disabled = true;
            const btn = document.createElement("button");
            btn.className = "copy-button";
            btn.onclick = () => copyToClipboard(inp.id);
            wrap.appendChild(inp); wrap.appendChild(btn);
            sec.appendChild(wrap);
          });
          container.appendChild(sec);

        } else {
          // multiple subsections
          keys.forEach(sub => {
            const sec = document.createElement("section");
            const sid = `${cat.replace(/\s+/g,"")}_${sub.replace(/\s+/g,"")}`;
            sec.id = sid;
            const h2 = document.createElement("h2");
            h2.textContent = `${cat} – ${sub}`;
            sec.appendChild(h2);
            subs[sub].forEach((item,i) => {
              const wrap = document.createElement("div");
              wrap.className = "textbox-container";
              const inp = document.createElement("input");
              inp.type = "text"; inp.className = "textbox";
              inp.value = `${item.name}: ${item.code}`;
              inp.id = `tb_${sid}_${i}`;
              inp.disabled = true;
              const btn = document.createElement("button");
              btn.className = "copy-button";
              btn.onclick = () => copyToClipboard(inp.id);
              wrap.appendChild(inp); wrap.appendChild(btn);
              sec.appendChild(wrap);
            });
            container.appendChild(sec);
          });
        }
      });
    }

    // Initialize on DOM ready
    document.addEventListener("DOMContentLoaded", async () => {
      try {
        const rows = await fetchAll(SHEET_ID, SHEET_GIDS);
        const data = rowsToData(rows);
        generateNav(data);
        buildContent(data);
      } catch (err) {
        console.error("Load failed:", err);
        document.getElementById("mainContent").innerHTML =
          `<p style="color:red">Unable to fetch event data.<br>${err.message}</p>`;
      }
    });
  </script>
</body>
</html>
