<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Gamers-Hell Command</title>
  <style>
    html, body { margin: 0; padding: 0; height: 100vh; }
    body {
      display: grid;
      grid-template-columns: 360px 1fr 360px;
      grid-template-areas: "navleft main navright";
      font-family: Arial, sans-serif;
      background: #3c6e8d65;
    }
    .sidenav  { grid-area: navleft; }
    .sidenav2 { grid-area: navright; }
    .main     { grid-area: main; overflow-y: auto; padding: 20px; box-sizing: border-box; }
    .sidenav, .sidenav2 {
      background: #111; color: #818181; overflow-y: auto; height: 100%;
    }
    .sidenav a, .sidenav2 a {
      display: block; padding: 8px 16px; font-size: 16px;
      text-decoration: none; color: inherit;
    }
    .sidenav a:hover, .sidenav2 a:hover { color: #f1f1f1; }
    .sidenav details { padding: 4px 16px; color: #818181; cursor: pointer; }
    .sidenav summary { list-style: none; font-size: 16px; user-select: none; }
    .sidenav summary::-webkit-details-marker { display: none; }
    .sidenav summary::before {
      content: "▸"; display: inline-block; width: 1em; transition: transform 0.2s;
    }
    .sidenav details[open] summary::before { content: "▾"; }
    .sidenav details a { padding-left: 32px; font-size: 15px; }
    .center { text-align: center; margin-bottom: 1em; }
    h1, h2 { margin: 0.5em 0; }
    h2 { border-bottom: 1px solid #ccc; padding-bottom: 0.2em; margin-top: 1.5em; }
    .cat-heading { font-size: 1.6em; margin: 1.5em 0 0.5em 0; color: #2b4765; }
    .textbox-container {
      display: flex; align-items: center; margin: 6px 0;
    }
    .textbox {
      flex: 1; padding: 6px; font-size: 14px;
      border: 1px solid #ccc; border-radius: 4px; background: #fff;
    }
    .copy-button {
      width: 24px; height: 24px; margin-left: 6px;
      border: none; cursor: pointer; border-radius: 4px;
      background: url('https://i.postimg.cc/Pf2Qp0Xq/World-Completion.png') no-repeat center/cover;
    }
    .copy-button:hover {
      background-image: url('https://i.postimg.cc/qMNzGyvH/pve-e6fdf7c3.png');
    }
    .drops-container {
      margin-left: 32px; margin-top: 8px;
    }
    .item-drop {
      display: flex; align-items: center; gap: 8px;
      margin: 4px 0; font-size: 14px;
    }
    .item-drop img { width: 24px; height: 24px; }
    .item-drop small { color: #555; margin-left: 4px; }
    details summary {
      cursor: pointer;
      font-weight: bold;
      background: #eee;
      padding: 4px 8px;
      border-radius: 4px;
      margin-bottom: 4px;
      user-select: none;
    }
    footer {
      text-align: center; padding: 1em 0; background: #ececec;
      margin-top: 2em; font-size: 0.9em;
    }
    textarea { width: 100%; max-width: 600px; }
    .drop-type-guaranteed { color: #007c1e; font-weight: bold; margin-left: 8px; }
    .drop-type-chance { color: #c00; font-weight: bold; margin-left: 8px; }
  </style>
</head>
<body>
  <!-- LEFT NAVIGATION MENU -->
  <nav class="sidenav" id="sideNav"></nav>

  <!-- MAIN CONTENT -->
  <div class="main">
    <section id="Welcome" class="center">
      <h1>Welcome Commander</h1>
      <script>
        (function(){
          const PASS = "PvE";
          if (prompt('Password?','') !== PASS) {
            location.href = 'https://sites.google.com/view/gamers-hell-community';
          } else alert('Welcome Commander');
        })();
      </script>
    </section>
    <div id="mainContent"></div>
    <section id="Credits" class="center">
      <h2>Credits</h2>
      <textarea rows="6" disabled>
Gamers-Hell Community
Players Vs Events:
  Blaz, Devilish Rain, Stormmyknight, Beina, Geri V

Websites:
  https://wiki.guildwars2.com/wiki
  https://gw2efficiency.com/
  http://gw2timer.com/
      </textarea>
    </section>
    <footer>&copy; 2025 Gamers-Hell Community</footer>
  </div>

  <!-- RIGHT TIMER MENU -->
  <nav class="sidenav2">
    <iframe
      src="http://gw2timer.com/?page=Timetable&enu_Language=en&int_setClock=2&bol_use24Hour=true"
      width="100%" height="100%" frameborder="0"
      style="box-shadow:0 0 12px #223;">
    </iframe>
  </nav>

<script>
/* =========================
   DATA STRUCTURE
   ========================= */
// Use note: "Guaranteed" or "Chance" (case-insensitive) if you want to control copy-paste output.
const data = {
  "Core Tyria": {
    "World Bosses": [
      {
        name: "Taidha Covington",
        code: "[&BKgBAAA=]",
        location: "Bloodtide Coast",
        drops: [
          { id: 9346, note: "Guaranteed" },
          { id: 19357, note: "Chance" },
          { id: 19361, note: "Chance" }
        ]
      },
      {
        name: "Karka Queen",
        code: "[&BNcGAAA=]",
        location: "Southsun Cove",
        drops: [
          { id: 37897, note: "Guaranteed" },
          { id: 37899, note: "Chance" },
          { id: 49509 }
        ]
      },
      {
        name: "Shadow Behemoth",
        code: "[&BPcAAAA=]",
        location: "Queensdale",
        drops: [
          { id: 12345 }
        ]
      }
    ]
  }
  // Add more categories/groups as needed!
};

/* =========================
   COPY-TO-CLIPBOARD FUNCTION
   ========================= */
function copyToClipboard(text) {
  navigator.clipboard.writeText(text).then(
    () => alert(`Copied:\n${text}`),
    () => alert('Copy failed!')
  );
}

/* =========================
   SIDEBAR NAVIGATION
   ========================= */
function buildNav(parent, obj) {
  Object.entries(obj).forEach(([key,val]) => {
    if (Array.isArray(val)) {
      const a = document.createElement('a');
      a.href = `#${key.replace(/\s+/g,'')}`;
      a.textContent = key;
      parent.appendChild(a);
    } else {
      const details = document.createElement('details');
      const summary = document.createElement('summary');
      summary.textContent = key;
      details.appendChild(summary);
      buildNav(details,val);
      parent.appendChild(details);
    }
  });
}
function generateNav() {
  const nav = document.getElementById('sideNav');
  nav.innerHTML = '';
  nav.appendChild(Object.assign(document.createElement('a'), { href: '#Welcome', textContent: 'Welcome' }));
  buildNav(nav, data);
  nav.appendChild(Object.assign(document.createElement('a'), { href: '#Credits', textContent: 'Credits' }));
}

/* =========================
   COIN FORMATTER
   ========================= */
function formatCoin(value) {
  value = Number(value) || 0;
  const gold = Math.floor(value / 10000);
  const silver = Math.floor((value % 10000) / 100);
  const copper = value % 100;
  let str = '';
  if (gold) str += gold + 'g ';
  if (gold || silver) str += silver + 's ';
  str += copper + 'c';
  return str.trim();
}

/* =========================
   FETCH ITEM DATA (API)
   ========================= */
async function fetchItemData(id) {
  try {
    const [item, price] = await Promise.all([
      fetch(`https://api.guildwars2.com/v2/items/${id}`).then(r=>r.json()),
      fetch(`https://api.guildwars2.com/v2/commerce/prices/${id}`).then(r=>r.json())
    ]);
    return {
      name: item.name,
      icon: item.icon,
      value: price?.sells?.unit_price || price.lowest_sell_unit_price || 0
    };
  } catch {
    return { name: `Item ${id}`, icon: '', value: 0 };
  }
}

/* =========================
   MAIN CONTENT BUILDER
   ========================= */
async function buildContent(parent, obj) {
  for (const [cat, groups] of Object.entries(obj)) {
    // Category heading
    const catHeading = document.createElement('div');
    catHeading.className = 'cat-heading';
    catHeading.textContent = cat;
    parent.appendChild(catHeading);

    for (const [group, bosses] of Object.entries(groups)) {
      const section = document.createElement('section');
      section.id = group.replace(/\s+/g,'');
      section.innerHTML = `<h2>${group}</h2>`;
      for (let boss of bosses) {
        const bossDiv = document.createElement('div');
        bossDiv.className = 'boss';
        bossDiv.innerHTML = `<h3>${boss.name} <small style="font-weight:normal;color:#888;">(${boss.location})</small></h3>`;
        // Fetch all drops for this boss
        const dropDataArr = [];
        for (const drop of boss.drops) {
          const itemData = await fetchItemData(drop.id);
          dropDataArr.push({ ...drop, ...itemData });
        }
        // Separate guaranteed and chance drops
        const guaranteedDrops = dropDataArr.filter(d => (d.note || '').toLowerCase() === 'guaranteed');
        const chanceDrops = dropDataArr.filter(d => (d.note || '').toLowerCase() === 'chance');
        // Find the most valuable chance drop
        let mostValuableChance = null;
        if (chanceDrops.length) {
          mostValuableChance = chanceDrops.reduce((max, d) => d.value > max.value ? d : max, chanceDrops[0]);
        }
        // Build copy-paste string
        let parts = [];
        guaranteedDrops.forEach(d =>
          parts.push(`Guaranteed to drop ${d.name} (Value: ${formatCoin(d.value)})`)
        );
        if (mostValuableChance) {
          parts.push(`Chance to drop ${mostValuableChance.name} (Value: ${formatCoin(mostValuableChance.value)})`);
        }
        // If no notes at all, just list all drops by value
        if (!guaranteedDrops.length && !chanceDrops.length) {
          dropDataArr.sort((a, b) => b.value - a.value);
          dropDataArr.forEach(d =>
            parts.push(`${d.name} (Value: ${formatCoin(d.value)})`)
          );
        }
        const copyText = `${boss.name} | ${boss.code} | ${boss.location} | ${parts.join(', ')}`;
        // Copy-paste row
        const wrap = document.createElement('div');
        wrap.className = 'textbox-container';
        const inp = document.createElement('input');
        inp.type = 'text';
        inp.className = 'textbox';
        inp.value = copyText;
        inp.readOnly = true;
        const btn = document.createElement('button');
        btn.className = 'copy-button';
        btn.title = `Copy ${boss.name}`;
        btn.onclick = ()=>copyToClipboard(copyText);
        wrap.appendChild(inp);
        wrap.appendChild(btn);
        bossDiv.appendChild(wrap);
        // Drops collapsible
        const details = document.createElement('details');
        const summary = document.createElement('summary');
        summary.textContent = 'Show/Hide Drops';
        details.appendChild(summary);
        const dropsDiv = document.createElement('div');
        dropsDiv.className = 'drops-container';
        dropDataArr.forEach(d => {
          let dropType = '';
          if ((d.note || '').toLowerCase() === 'guaranteed') dropType = '<span class="drop-type-guaranteed">(Guaranteed)</span>';
          else if ((d.note || '').toLowerCase() === 'chance') dropType = '<span class="drop-type-chance">(Chance)</span>';
          div = document.createElement('div');
          div.className = 'item-drop';
          div.innerHTML = `
            <img src="${d.icon||''}" alt="${d.name||''}">
            <span>${d.name}</span>
            ${dropType}
            <small>Value: ${formatCoin(d.value)}</small>
          `;
          dropsDiv.appendChild(div);
        });
        details.appendChild(dropsDiv);
        bossDiv.appendChild(details);
        section.appendChild(bossDiv);
      }
      parent.appendChild(section);
    }
  }
}

/* =========================
   INIT
   ========================= */
document.addEventListener('DOMContentLoaded', async () => {
  generateNav();
  const main = document.getElementById('mainContent');
  main.innerHTML = '';
  await buildContent(main, data);
});
</script>
</body>
</html>
