<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Gamers-Hell Command</title>
  <style>
    html, body { margin: 0; padding: 0; height: 100vh; }
    body {
      display: grid;
      grid-template-columns: 320px 1fr 320px;
      grid-template-areas: "navleft main navright";
      font-family: Arial, sans-serif;
      background: #3c6e8d65;
      min-height: 100vh;
      transition: grid-template-columns 0.3s;
    }
    body.left-closed  { grid-template-columns: 0 1fr 320px; }
    body.right-closed { grid-template-columns: 320px 1fr 0; }
    body.both-closed  { grid-template-columns: 0 1fr 0; }

    /* --- Sidebar Shared Styles --- */
    .sidebar {
      position: fixed;
      top: 0;
      width: 320px;
      height: 100vh;
      background: #222;
      color: #fff;
      box-shadow: 2px 0 8px rgba(0,0,0,0.2);
      transition: transform 0.3s;
      z-index: 1000;
      display: flex;
      flex-direction: column;
    }
    .sidebar.left  { left: 0;  transform: translateX(0); border-right: 1px solid #111; }
    .sidebar.right { right: 0; transform: translateX(0);  border-left:  1px solid #111; }
    .sidebar.closed.left  { transform: translateX(-100%); }
    .sidebar.closed.right { transform: translateX(100%); }
    .sidebar-toggle {
      position: absolute;
      top: 20px;
      width: 36px; height: 36px;
      background: #444; color: #fff; border: none;
      border-radius: 0 4px 4px 0;
      cursor: pointer; font-size: 22px;
      display: flex; align-items: center; justify-content: center;
      box-shadow: 2px 2px 6px rgba(0,0,0,0.1);
      transition: background 0.2s;
      z-index: 2;
    }
    .sidebar-toggle.right { left: -40px; border-radius: 4px 0 0 4px; }
    .sidebar-toggle.left  { right: -40px; }
    .sidebar-toggle:hover { background: #666; }

    /* --- Event Timer Styles --- */
    .event-list { margin-top: 60px; padding: 16px; max-height: calc(100vh - 60px); overflow-y: auto; }
    .event-row { display: flex; justify-content: space-between; align-items: center; padding: 10px 0; border-bottom: 1px solid #333; font-size: 1rem; }
    .event-row.upcoming { background: #29334a; font-weight: bold; border-radius: 4px; }
    .event-name { flex: 2; }
    .event-time { flex: 1; text-align: right; font-family: monospace; }

    /* --- Navigation Styles --- */
    .sidebar-nav { margin-top: 60px; }
    .sidebar-nav a {
      display: block; padding: 8px 16px; font-size: 16px;
      text-decoration: none; color: inherit;
    }
    .sidebar-nav a:hover { color: #f1f1f1; }
    .sidebar-nav details { padding: 4px 16px; color: #818181; cursor: pointer; }
    .sidebar-nav summary { list-style: none; font-size: 16px; user-select: none; }
    .sidebar-nav summary::-webkit-details-marker { display: none; }
    .sidebar-nav summary::before {
      content: "▸"; display: inline-block; width: 1em; transition: transform 0.2s;
    }
    .sidebar-nav details[open] summary::before { content: "▾"; }
    .sidebar-nav details a { padding-left: 32px; font-size: 15px; }
    .cat-heading { font-size: 1.6em; margin: 1.5em 0 0.5em 0; color: #2b4765; }

    /* --- Main Content --- */
    .main     { grid-area: main; overflow-y: auto; padding: 20px; box-sizing: border-box; transition: all 0.3s; min-height: 100vh; }
    .center { text-align: center; margin-bottom: 1em; }
    h1, h2 { margin: 0.5em 0; }
    h2 { border-bottom: 1px solid #ccc; padding-bottom: 0.2em; margin-top: 1.5em; }
    textarea { width: 100%; }
    footer { text-align: center; color: #888; margin-top: 30px; }

    /* --- Boss/Item Styles (from your mainContent code) --- */
    .textbox-container {
      display: flex; align-items: center; margin: 6px 0;
    }
    .textbox {
      flex: 1; padding: 6px; font-size: 14px;
      border: 1px solid #ccc; border-radius: 4px; background: #fff;
    }
    .copy-button {
      width: 24px; height: 24px; margin-left: 6px;
      border: none; cursor: pointer; border-radius: 4px;
      background: url('https://i.postimg.cc/Pf2Qp0Xq/World-Completion.png') no-repeat center/cover;
    }
    .copy-button:hover {
      background-image: url('https://i.postimg.cc/qMNzGyvH/pve-e6fdf7c3.png');
    }
    .drops-container {
      margin-left: 32px; margin-top: 8px;
    }
    .item-drop {
      display: flex; align-items: center; gap: 8px;
      margin: 4px 0; font-size: 14px;
    }
    .item-drop img { width: 24px; height: 24px; }
    .item-drop small { color: #555; margin-left: 4px; }
    details summary {
      cursor: pointer;
      font-weight: bold;
      background: #eee;
      padding: 4px 8px;
      border-radius: 4px;
      margin-bottom: 4px;
      user-select: none;
    }
    details { margin-bottom: 8px; }
    .boss-block { margin-bottom: 20px; background: #f8fcff; border-radius: 8px; box-shadow: 0 0 8px #d1e6f6; padding: 10px 0 10px 0; }
    .boss-block h3 { margin: 0 0 6px 0; }
    .drop-type-guaranteed { color: #007c1e; font-weight: bold; margin-left: 8px; }
    .drop-type-chance { color: #c00; font-weight: bold; margin-left: 8px; }
    @media (max-width: 1000px) {
      body, body.left-closed, body.right-closed, body.both-closed {
        grid-template-columns: 0 1fr 0 !important;
      }
      .sidebar { width: 100vw; left: 0 !important; right: auto !important; border-radius: 0; }
      .sidebar.left  { transform: translateX(-100%); }
      .sidebar.right { transform: translateX(100%); }
      .sidebar-toggle.left { right: 0; left: auto; }
      .sidebar-toggle.right { left: 0; right: auto; }
    }
  </style>
</head>
<body>
  <!-- LEFT SIDEBAR: Navigation -->
  <nav class="sidebar left" id="sidebarLeft">
    <button class="sidebar-toggle left" id="toggleLeft" title="Hide Menu">&times;</button>
    <nav class="sidebar-nav" id="sideNav"></nav>
  </nav>

  <!-- MAIN CONTENT (Unchanged) -->
  <div class="main">
    <section id="Welcome" class="center">
      <h1>Welcome Commander</h1>
      <script>
        (function(){
          const PASS = "PvE";
          if (prompt('Password?','') !== PASS) {
            location.href = 'https://sites.google.com/view/gamers-hell-community';
          } else alert('Welcome Commander');
        })();
      </script>
    </section>
    <div id="mainContent"></div>
    <section id="Credits" class="center">
      <h2>Credits</h2>
      <textarea rows="6" disabled>
Gamers-Hell Community
Players Vs Events:
  Blaz, Devilish Rain, Stormmyknight, Beina, Geri V

Websites:
  https://wiki.guildwars2.com/wiki
  https://gw2efficiency.com/
  http://gw2timer.com/
      </textarea>
    </section>
    <footer>&copy; 2025 Gamers-Hell Community</footer>
  </div>

  <!-- RIGHT SIDEBAR: GW2 Event Timer -->
  <nav class="sidebar right" id="sidebarRight">
    <button class="sidebar-toggle right" id="toggleRight" title="Hide Events">&times;</button>
    <div class="event-list">
      <!-- Events will be injected here -->
    </div>
  </nav>

<script>
/* --- Navigation Data and Builder --- */
const data = {
  "Core Tyria": {
    "World Bosses": [
      {
        name: "Taidha Covington",
        code: "[&BKgBAAA=]",
        location: "Bloodtide Coast",
        drops: [
          { id: 46733, note: "Guaranteed" },
          { id: 19357, note: "Chance" },
          { id: 19361, note: "Chance" }
        ]
      },
      {
        name: "Karka Queen",
        code: "[&BNcGAAA=]",
        location: "Southsun Cove",
        drops: [
          { id: 37897, note: "Guaranteed" },
          { id: 37899, note: "Chance" },
          { id: 49509, note: "Chance" },
          { id: 45597, note: "Chance" },
          { id: 46713, note: "Chance" },
          { id: 46689, note: "Chance" }
        ]
      },
      {
        name: "Shadow Behemoth",
        code: "[&BPcAAAA=]",
        location: "Queensdale",
        drops: [
          { id: 46733, note: "Guaranteed"},
          { id: 8535, note: "Chance" },
          { id: 19360, note: "Chance" },
          { id: 31051, note: "Chance" }
        ]
      }
    ]
  }
};
function buildNav(parent, obj) {
  Object.entries(obj).forEach(([key,val]) => {
    if (Array.isArray(val)) {
      const a = document.createElement('a');
      a.href = `#${key.replace(/\s+/g,'')}`;
      a.textContent = key;
      parent.appendChild(a);
    } else {
      const details = document.createElement('details');
      const summary = document.createElement('summary');
      summary.textContent = key;
      details.appendChild(summary);
      buildNav(details,val);
      parent.appendChild(details);
    }
  });
}
function generateNav() {
  const nav = document.getElementById('sideNav');
  nav.innerHTML = '';
  nav.appendChild(Object.assign(document.createElement('a'), { href: '#Welcome', textContent: 'Welcome' }));
  buildNav(nav, data);
  nav.appendChild(Object.assign(document.createElement('a'), { href: '#Credits', textContent: 'Credits' }));
}

/* --- Main Content Dynamic Boss/Item Logic (from your mainContent code) --- */
function copyToClipboard(text) {
  navigator.clipboard.writeText(text).then(
    () => alert(`Copied:\n${text}`),
    () => alert('Copy failed!')
  );
}
function formatCoin(value) {
  value = Number(value) || 0;
  const gold = Math.floor(value / 10000);
  const silver = Math.floor((value % 10000) / 100);
  const copper = value % 100;
  let str = '';
  if (gold) str += gold + 'g ';
  if (gold || silver) str += silver + 's ';
  str += copper + 'c';
  return str.trim();
}
async function fetchItemData(id) {
  try {
    const [item, price] = await Promise.all([
      fetch(`https://api.guildwars2.com/v2/items/${id}`).then(r=>r.json()),
      fetch(`https://api.guildwars2.com/v2/commerce/prices/${id}`).then(r=>r.json())
    ]);
    return {
      name: item.name,
      icon: item.icon,
      value: price?.sells?.unit_price || price.lowest_sell_unit_price || 0
    };
  } catch {
    return { name: `Item ${id}`, icon: '', value: 0 };
  }
}
async function buildContent(parent, obj) {
  for (const [cat, groups] of Object.entries(obj)) {
    const catDetails = document.createElement('details');
    catDetails.open = true;
    const catSummary = document.createElement('summary');
    catSummary.innerHTML = `<span class="cat-heading">${cat}</span>`;
    catDetails.appendChild(catSummary);

    for (const [group, bosses] of Object.entries(groups)) {
      const groupDetails = document.createElement('details');
      groupDetails.open = false;
      const groupSummary = document.createElement('summary');
      groupSummary.innerHTML = `<h2 style="display:inline">${group}</h2>`;
      groupDetails.appendChild(groupSummary);

      for (let boss of bosses) {
        const bossDiv = document.createElement('div');
        bossDiv.className = 'boss-block';
        bossDiv.innerHTML = `<h3>${boss.name} <small style="font-weight:normal;color:#888;">(${boss.location})</small></h3>`;
        const dropDataArr = [];
        for (const drop of boss.drops) {
          const itemData = await fetchItemData(drop.id);
          dropDataArr.push({ ...drop, ...itemData });
        }
        const guaranteedDrops = dropDataArr.filter(d => (d.note || '').toLowerCase() === 'guaranteed');
        const chanceDrops = dropDataArr.filter(d => (d.note || '').toLowerCase() === 'chance');
        let mostValuableChance = null;
        if (chanceDrops.length) {
          mostValuableChance = chanceDrops.reduce((max, d) => d.value > max.value ? d : max, chanceDrops[0]);
        }
        let parts = [];
        guaranteedDrops.forEach(d =>
          parts.push(`Guaranteed to drop ${d.name} (Value: ${formatCoin(d.value)})`)
        );
        if (mostValuableChance) {
          parts.push(`Chance to drop ${mostValuableChance.name} (Value: ${formatCoin(mostValuableChance.value)})`);
        }
        if (!guaranteedDrops.length && !chanceDrops.length) {
          dropDataArr.sort((a, b) => b.value - a.value);
          dropDataArr.forEach(d =>
            parts.push(`${d.name} (Value: ${formatCoin(d.value)})`)
          );
        }
        const copyText = `${boss.name} | ${boss.code} | ${boss.location} | ${parts.join(', ')}`;
        const wrap = document.createElement('div');
        wrap.className = 'textbox-container';
        const inp = document.createElement('input');
        inp.type = 'text';
        inp.className = 'textbox';
        inp.value = copyText;
        inp.readOnly = true;
        const btn = document.createElement('button');
        btn.className = 'copy-button';
        btn.title = `Copy ${boss.name}`;
        btn.onclick = ()=>copyToClipboard(copyText);
        wrap.appendChild(inp);
        wrap.appendChild(btn);
        bossDiv.appendChild(wrap);
        const dropsDetails = document.createElement('details');
        dropsDetails.open = false;
        const dropsSummary = document.createElement('summary');
        dropsSummary.textContent = 'Show/Hide Drops';
        dropsDetails.appendChild(dropsSummary);
        const dropsDiv = document.createElement('div');
        dropsDiv.className = 'drops-container';
        dropDataArr.forEach(d => {
          let dropType = '';
          if ((d.note || '').toLowerCase() === 'guaranteed') dropType = '<span class="drop-type-guaranteed">(Guaranteed)</span>';
          else if ((d.note || '').toLowerCase() === 'chance') dropType = '<span class="drop-type-chance">(Chance)</span>';
          const div = document.createElement('div');
          div.className = 'item-drop';
          div.innerHTML = `
            <img src="${d.icon||''}" alt="${d.name||''}">
            <span>${d.name}</span>
            ${dropType}
            <small>Value: ${formatCoin(d.value)}</small>
          `;
          dropsDiv.appendChild(div);
        });
        dropsDetails.appendChild(dropsDiv);
        bossDiv.appendChild(dropsDetails);

        groupDetails.appendChild(bossDiv);
      }
      catDetails.appendChild(groupDetails);
    }
    parent.appendChild(catDetails);
  }
}

/* --- Sidebar Toggle Logic --- */
function updateBodyClass() {
  const left  = !document.getElementById('sidebarLeft').classList.contains('closed');
  const right = !document.getElementById('sidebarRight').classList.contains('closed');
  if (left && right)      document.body.className = '';
  else if (left && !right)  document.body.className = 'right-closed';
  else if (!left && right)  document.body.className = 'left-closed';
  else                      document.body.className = 'both-closed';
}
document.getElementById('toggleLeft').onclick = function() {
  document.getElementById('sidebarLeft').classList.toggle('closed');
  updateBodyClass();
};
document.getElementById('toggleRight').onclick = function() {
  document.getElementById('sidebarRight').classList.toggle('closed');
  updateBodyClass();
};

/* --- GW2 Event Timer Sidebar Logic --- */
const EVENTS_JSON_URL = 'https://raw.githubusercontent.com/blish-hud/Community-Module-Pack/master/Events%20Module/ref/events.json';
function parseOffset(offset) {
  let t = offset.replace('Z', '').split(':');
  return { hour: parseInt(t[0], 10), minute: parseInt(t[1], 10) };
}
function parseRepeat(repeat) {
  let t = repeat.split(':');
  return parseInt(t[0], 10) * 60 + parseInt(t[1], 10);
}
function getNextOccurrence(offset, repeat) {
  const now = new Date();
  const today = new Date(Date.UTC(now.getUTCFullYear(), now.getUTCMonth(), now.getUTCDate(), 0, 0, 0, 0));
  const { hour, minute } = parseOffset(offset);
  let eventTime = new Date(today.getTime());
  eventTime.setUTCHours(hour, minute, 0, 0);
  const repeatMinutes = parseRepeat(repeat);
  while (eventTime < now) {
    eventTime = new Date(eventTime.getTime() + repeatMinutes * 60000);
  }
  return eventTime;
}
function toAmsterdamTimeStr(date) {
  return date.toLocaleTimeString('en-GB', { timeZone: 'Europe/Amsterdam', hour: '2-digit', minute: '2-digit' });
}
let events = [];
async function fetchEvents() {
  try {
    const response = await fetch(EVENTS_JSON_URL, { cache: "no-store" });
    if (!response.ok) throw new Error("Failed to fetch events");
    const data = await response.json();
    events = data.filter(e => e.offset && e.repeat);
  } catch (err) {
    events = [];
    console.error('Error fetching events:', err);
  }
}
function updateEvents() {
  const eventList = document.querySelector('#sidebarRight .event-list');
  eventList.innerHTML = '';
  if (!events.length) {
    eventList.innerHTML = '<div style="padding:20px;color:#aaa;">No events available.</div>';
    return;
  }
  const now = new Date();
  const nextEvents = events.map(event => {
    const nextTime = getNextOccurrence(event.offset, event.repeat);
    return { name: event.name, utcTime: nextTime, amsTime: toAmsterdamTimeStr(nextTime) };
  });
  nextEvents.sort((a, b) => a.utcTime - b.utcTime);
  let nextIdx = nextEvents.findIndex(ev => ev.utcTime > now);
  if (nextIdx === -1) nextIdx = 0;
  nextEvents.forEach((event, idx) => {
    const row = document.createElement('div');
    row.className = 'event-row' + (idx === nextIdx ? ' upcoming' : '');
    row.innerHTML = `<span class="event-name">${event.name}</span><span class="event-time">${event.amsTime}</span>`;
    eventList.appendChild(row);
  });
}
async function refreshAndUpdate() {
  await fetchEvents();
  updateEvents();
}

/* --- DOMContentLoaded: Build everything --- */
document.addEventListener('DOMContentLoaded', async () => {
  generateNav();
  const main = document.getElementById('mainContent');
  main.innerHTML = '';
  await buildContent(main, data);

  refreshAndUpdate();
  setInterval(refreshAndUpdate, 60000);
  document.addEventListener('visibilitychange', function() {
    if (!document.hidden) refreshAndUpdate();
  });
  updateBodyClass();
});
</script>
</body>
</html>
